var treeData = [
  {
    "year": 1085,
    "sgi": 1193,
    "d13c": -20.04,
    "prec": 4.9,
    "r1": 5,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1086,
    "sgi": 1333,
    "d13c": -19.89,
    "prec": 4.47,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1087,
    "sgi": 1602,
    "d13c": -20.23,
    "prec": 5.48,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "yes",
    "drought": "0"
  },
  {
    "year": 1088,
    "sgi": 1310,
    "d13c": -19.6,
    "prec": 3.61,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1089,
    "sgi": 747,
    "d13c": -19.58,
    "prec": 3.55,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1090,
    "sgi": 1269,
    "d13c": -19.81,
    "prec": 4.24,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1091,
    "sgi": 1002,
    "d13c": -20.15,
    "prec": 5.22,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "yes",
    "drought": "0"
  },
  {
    "year": 1092,
    "sgi": 1283,
    "d13c": -19.73,
    "prec": 3.99,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1093,
    "sgi": 368,
    "d13c": -19.83,
    "prec": 4.3,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1094,
    "sgi": 1402,
    "d13c": -19.46,
    "prec": 3.2,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1095,
    "sgi": 1238,
    "d13c": -19.28,
    "prec": 2.68,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1096,
    "sgi": 1438,
    "d13c": -19.22,
    "prec": 2.5,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1097,
    "sgi": 1447,
    "d13c": -19.29,
    "prec": 2.7,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1098,
    "sgi": 463,
    "d13c": -19.19,
    "prec": 2.41,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1099,
    "sgi": 1333,
    "d13c": -19.22,
    "prec": 2.5,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1100,
    "sgi": 1406,
    "d13c": -19.03,
    "prec": 1.94,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1101,
    "sgi": 985,
    "d13c": -19.29,
    "prec": 2.68,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1102,
    "sgi": 1141,
    "d13c": -19.07,
    "prec": 2.03,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1103,
    "sgi": 181,
    "d13c": -19.27,
    "prec": 2.63,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1104,
    "sgi": 1406,
    "d13c": -19.12,
    "prec": 2.2,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1105,
    "sgi": 1574,
    "d13c": -19.65,
    "prec": 3.75,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1106,
    "sgi": 1608,
    "d13c": -19.82,
    "prec": 4.25,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1107,
    "sgi": 1248,
    "d13c": -19.47,
    "prec": 3.23,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1108,
    "sgi": 1277,
    "d13c": -18.79,
    "prec": 1.22,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1109,
    "sgi": 1373,
    "d13c": -19.27,
    "prec": 2.64,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1110,
    "sgi": 1211,
    "d13c": -19.09,
    "prec": 2.12,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1111,
    "sgi": 1372,
    "d13c": -19.08,
    "prec": 2.08,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1112,
    "sgi": 1592,
    "d13c": -19.48,
    "prec": 3.26,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1113,
    "sgi": 1202,
    "d13c": -19.56,
    "prec": 3.48,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1114,
    "sgi": 1322,
    "d13c": -20.03,
    "prec": 4.87,
    "r1": 0,
    "r2": 0,
    "volcano": "yes",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1115,
    "sgi": 1254,
    "d13c": -19.89,
    "prec": 4.45,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1116,
    "sgi": 1250,
    "d13c": -19.59,
    "prec": 3.59,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1117,
    "sgi": 1211,
    "d13c": -19.27,
    "prec": 2.65,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1118,
    "sgi": 1248,
    "d13c": -19.49,
    "prec": 3.28,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "1"
  },
  {
    "year": 1119,
    "sgi": 1173,
    "d13c": -19.57,
    "prec": 3.53,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1120,
    "sgi": 856,
    "d13c": -20.11,
    "prec": 5.11,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "yes",
    "drought": "0"
  },
  {
    "year": 1121,
    "sgi": 748,
    "d13c": -20.39,
    "prec": 5.95,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "yes",
    "drought": "0"
  },
  {
    "year": 1122,
    "sgi": 1191,
    "d13c": -20.18,
    "prec": 5.31,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "yes",
    "drought": "0"
  },
  {
    "year": 1123,
    "sgi": 850,
    "d13c": -19.97,
    "prec": 4.7,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1124,
    "sgi": 1017,
    "d13c": -20.31,
    "prec": 5.7,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1125,
    "sgi": 1539,
    "d13c": -19.68,
    "prec": 3.84,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1126,
    "sgi": 794,
    "d13c": -19.45,
    "prec": 3.18,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "0"
  },
  {
    "year": 1127,
    "sgi": 307,
    "d13c": -19.35,
    "prec": 2.87,
    "r1": 0,
    "r2": 0,
    "volcano": "0",
    "nino": "0",
    "drought": "1"
  },
]

var w = 2100;
var h = 2150;
var svg = d3.select("svg")
      .attr("width",w)
      .attr("height",h)
      .style("background-color","white")

var minR = d3.min(treeData, d => d.sgi)
var maxR = d3.max(treeData, d => d.sgi)
var r2Scale = d3.scaleLinear()
            .domain([minR,maxR])
            .range([0.3,4]);

var minP = d3.min(treeData, d => d.prec)
var maxP = d3.max(treeData, d => d.prec)
var precScale = d3.scaleSequential()
            .domain([minP,maxP])
            .interpolator(d3.interpolate(
                "pink","darkgreen"
            ))

for (var i = 0; i < treeData.length; i++) {
  var rad1 = 0
  var rad2 = 0  
  if (treeData[i].r1==5){
        var index = i;
        rad1 = 5
        rad2 = treeData[i].r1+r2Scale(treeData[i].sgi)
        treeData[index].r2=rad2;
    }else{
        var index = i;
        rad1 = treeData[index-1].r2
        treeData[index].r1=rad1;
        rad2 = treeData[index-1].r2+r2Scale(treeData[i].sgi)
        treeData[index].r2=rad2;
    }
}

var blah = svg.append("g").attr("class","zoomContainer")
var arcGroup = blah
    .selectAll(".arcGroup")
    .data(treeData)
    .join("g")
    .attr("class","arcGroup")
    .attr("transform", "translate(0,"+w+")")
    // .call(zoom)
    // .on("click", function(){
    //   updateDrought();
    // })
var myPaths = arcGroup
    .append("path")
    .attr("class",function(d){
      if(d.drought==1){
        return "yes";
      }else{
        return "no";
      }
    })
    .attr("d", d3.arc()
    .innerRadius(function(d){
      return d.r1
    })
    .outerRadius(function(d){
      return d.r2
    })
    .startAngle(0)
    .endAngle(0.5*Math.PI)
    )
    .attr("fill",function(d){
      return precScale(d.prec)
    })
    .attr("opacity",1)
    .attr("stroke","black")
    .attr("stroke-width",0.5)
arcGroup
    .append("line")
    .attr("x1",function(d){
      return d.r1
    })
    .attr("x2",function(d){
      return d.r1
    })
    .attr("y1",0)
    .attr("y2",16)
    .attr("stroke","black")
    .attr("stroke-width",0.5)
    .attr("opacity",function(d,i){
      if (i%5==0){
        return 0.7
      }
      else{
        return 0
      }
    })
arcGroup
    .append("text")
    .attr("class","yearLabels")
    // .attr("x",function(d){
    //   return d.r1
    // })
    .attr("y",25)
    .attr("opacity",function(d,i){
      if (i%5==0){
        return 0.7
      }
      else{
        return 0
      }
    })
    .text(function(d){
        return d.year
    })
    .attr('transform', (d,i)=>{
      return 'translate( '+(d.r1+25)+' , '+16+'),'+ 'rotate(90)';})
    .style("font-size",9)

function updateDrought(){
  d3.selectAll(".yes")
  .transition()
  .attr("fill","red") 
  // function(d){
    // if(d.drought == "yes"){
      // return "red"
    // }
  //   else{
  //     return precScale(d.prec)
  //   }
  // })
  // .attr("opacity",function(d){
  //   if(d.drought == "yes"){
  //     return 1
  //   }
  //   else{
  //     return 0.2
  //   }
  // })
}






var zoom = d3.zoom()
    .on('zoom', handleZoom)
    .scaleExtent([1, 5])
    .translateExtent([[-w, -h], [w, h]]);
  
function handleZoom(e) {
    d3.select('.zoomContainer')
      .attr('transform', e.transform);
  }

initZoom();
function initZoom() {
    // d3.select('svg')
    //   .call(zoom);

    svg.transition().duration(2500).call(
      zoom.transform,
      d3.zoomIdentity.translate(0,0).scale(1.5).translate(0, -h/2)
    );
    // d3.select('svg')
    //   .transition()
    //   .duration(2000)
    //   .call(zoom.scaleBy, 2)
      // .transition()
      // .duration(3000)
      // .call(zoom.translateBy,w/2, h/2);
  }



